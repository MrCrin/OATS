(function(i){var c="0.1",h=this,a="balloon-inflated",b="balloon-floating",l,k;k={isArray:function(m){return Object.prototype.toString.call(m)==="[object Array]"},each:function(q,o,n){var p=(n!==undefined)?o.bind(n):o,m,r;if(this.isArray(q)){if(Array.forEach!==undefined){q.forEach(p)}else{for(m=0;m<q.length;m+=1){p(q[m],m,q)}}}else{for(r in q){if(q.hasOwnProperty(r)){p(q[r],r,q)}}}},getOffset:function(n){var m=0,p=0;while(n&&!isNaN(n.offsetLeft)&&!isNaN(n.offsetTop)){m+=n.offsetLeft-n.scrollLeft;p+=n.offsetTop-n.scrollTop;n=n.parentNode}return{left:m,top:p}},toggleClassName:function(q,m){if(this.hasClass(q,m)){var p=q.className.split(" "),n=p.indexOf(m);p.splice(n,1);q.className=p.join(" ")}else{if(q.className.length>0){q.className+=" "+m}else{q.className+=m}}},getWindowScrollPos:function(){return(h.pageYOffset!==undefined)?h.pageYOffset:(i.documentElement||i.body.parentNode||i.body).scrollTop},hasClass:function(n,m){return n.className.indexOf(m)!==-1},setOption:function(n,m,o,p){if(m[o]!==undefined){n[o]=m[o]}else{n[o]=p}}};function d(m,n){var o=n;if(n===undefined){o=0}k.each(m.headerStack.slice(o),function(q,p){if(k.hasClass(q,a)){k.toggleClassName(q,a);q.parentNode.style.height="";q.parentNode.style.width="";if(m.stackHeaders&&p>0){q.style.top=""}}if(!k.hasClass(q,b)){k.toggleClassName(q,b)}})}function j(m,n){k.each(m.headerStack.slice(0,n),function(s,p){if(!k.hasClass(s,a)){k.toggleClassName(s,a);s.parentNode.style.height=s.offsetHeight+"px";s.parentNode.style.width=s.offsetWidth+"px"}if(m.currentHeader>0&&m.stackHeaders){var r=0,q;for(q=0;q<p;q+=1){r+=m.headerStack[q].offsetHeight}s.style.top=r+"px"}if(k.hasClass(s,b)){k.toggleClassName(s,b)}})}function f(p,r){d(p);var n,m,q=0,o=0;for(n=p.headerStack.length-1;n>=0;n-=1){o=0;if(p.stackHeaders){for(m=0;m<n;m+=1){o+=p.headerStack[m].offsetHeight}}if((r+o)>=p.headerStack[n].offsetTop){q=n;break}else{if(n===0){q=-1}}}if(q!==-1){p.currentHeader=q;if(p.stackHeaders){p.offsetTop=o+p.headerStack[q].offsetHeight}j(p,q+1);d(p,q+1)}}function e(n,m){var o=(m===h)?k.getWindowScrollPos():k.getOffset(m).top;f(n,o)}function g(m){m.sort(function(o,n){return k.getOffset(o).top-k.getOffset(n).top});k.each(m.slice(1),function(n){if(!k.hasClass(n,b)){k.toggleClassName(n,b)}})}l=function(m){this.idMap={};this.headerStack=[];this.currentHeader=0;if(m!==undefined){k.setOption(this,m,"scrollView",h);k.setOption(this,m,"stackHeaders",false)}else{this.scrollView=h;this.stackHeaders=false}};l.prototype={inflate:function(p){var m=this;function n(o){if(m.idMap[o]!==undefined){m.deflate(o)}m.idMap[o]=i.getElementById(o);m.headerStack.push(m.idMap[o])}if(typeof p==="object"){k.each(p,function(o){n(o)})}else{n(p)}g(this.headerStack);this.scrollView.onscroll=function(){e(m,m.scrollView)}},deflate:function(p){var n=this;function m(o){if(n.idMap[o]!==undefined){if(k.hasClass(n.idMap[o],b)){k.toggleClassName(n.idMap[o],b)}if(k.hasClass(n.idMap[o],a)){k.toggleClassName(n.idMap[o],a)}if(n.headerStack.indexOf(n.idMap[o])<=n.currentHeader&&n.currentHeader>0){n.currentHeader-=1}n.headerStack.splice(n.headerStack.indexOf(n.idMap[o]),1);if(n.headerStack.length===0&&n.scrollView.onScroll!==null){n.scrollView.onscroll=null}delete n.idMap[o]}}if(typeof p==="object"){k.each(p,function(o){m(o)})}else{m(p)}},destroy:function(){var m=this;k.each(this.idMap,function(n){m.deflate(n)})},version:function(){return c}};h.Balloon=l;h.Balloon.destroy=function(){delete h.Balloon}}.bind(this)(this.document));